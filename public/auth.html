<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesi√≥n | AWS User Group Playa Vicente</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/auth.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>ü¶à Tibur√≥n</h1>
                <h2>AWS User Group Playa Vicente</h2>
                <p>Inicia sesi√≥n para acceder a la comunidad</p>
            </div>
            
            <div class="auth-content">
                <div id="authMessage" class="auth-message" style="display: none;"></div>
                
                <div class="auth-buttons">
                    <button id="googleLoginBtn" class="btn-google">
                        <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" width="20" height="20">
                        Continuar con Google
                    </button>
                </div>
                
                <div class="auth-info">
                    <p>Al iniciar sesi√≥n, aceptas nuestros t√©rminos de servicio y pol√≠tica de privacidad.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.24.min.js"></script>
    <script src="https://unpkg.com/amazon-cognito-identity-js@6.3.12/dist/amazon-cognito-identity.min.js"></script>
    <script src="assets/js/auth.js"></script>
    
    <script>
        // Manejar par√°metros de URL
        const urlParams = new URLSearchParams(window.location.search);
        const redirect = urlParams.get('redirect');
        const reason = urlParams.get('reason');
        
        // Mostrar mensaje seg√∫n la raz√≥n
        const authMessage = document.getElementById('authMessage');
        if (reason && authMessage) {
            let message = '';
            switch(reason) {
                case 'unauthorized':
                    message = '‚ùå Necesitas iniciar sesi√≥n para acceder al panel de administraci√≥n.';
                    break;
                case 'expired':
                    message = '‚è∞ Tu sesi√≥n ha expirado. Por favor, inicia sesi√≥n nuevamente.';
                    break;
                case 'error':
                    message = '‚ö†Ô∏è Hubo un error con tu sesi√≥n. Por favor, inicia sesi√≥n nuevamente.';
                    break;
                default:
                    message = '‚ÑπÔ∏è Por favor, inicia sesi√≥n para continuar.';
            }
            authMessage.textContent = message;
            authMessage.style.display = 'block';
        }
        
        // Configurar bot√≥n de Google
        document.getElementById('googleLoginBtn').addEventListener('click', () => {
            // Guardar redirect para despu√©s del login
            if (redirect) {
                sessionStorage.setItem('postLoginRedirect', redirect);
            }
            
            // Redirigir directamente a Cognito OAuth
            const cognitoAuthUrl = 'https://auth.tiburoncp.siegfried-fs.com/oauth2/authorize?' +
                'client_id=1gsjecdf86pgdgvvis7l30hha1&' +
                'response_type=code&' +
                'scope=email+openid+profile+aws.cognito.signin.user.admin&' +
                'redirect_uri=' + encodeURIComponent(window.location.origin) + '&' +
                'identity_provider=Google';
            
            window.location.href = cognitoAuthUrl;
        });
        
        // Si ya est√° autenticado, redirigir
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar si hay tokens en sessionStorage
            const accessToken = sessionStorage.getItem('accessToken');
            if (accessToken) {
                const redirectTo = redirect || 'index';
                window.location.href = redirectTo + '.html';
            }
        });
    </script>
</body>
</html>
